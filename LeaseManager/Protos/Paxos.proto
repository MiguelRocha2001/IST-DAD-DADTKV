syntax = "proto3";

option csharp_namespace = "GrpcPaxos";

package paxos;

service Paxos {
  rpc Prepare (PrepareRequest) returns (PrepareReply);
  //rpc Promise (PromiseRequest) returns (PromiseReply);
  rpc Accept (AcceptRequest) returns (Empty);
  rpc Accepted (AcceptedRequest) returns (AcceptedReply);
}

message Empty {}

message PrepareRequest {
  int32 epoch = 1;
  int32 id = 2;
}

message PrepareReply {
  message AcceptedValue {
    int32 id = 1;
    //repeated Lease leases = 2;
    string value = 2;
  }
  int32 id = 1; 
  AcceptedValue acceptedValue = 2;
}

message AcceptRequest {
  int32 id = 1;
  //repeated Lease leases = 2;
  string value = 2;
}

message Lease {
  string transactionManager = 1;
  repeated string permissions = 2;
  int32 epoch = 3;
}

message AcceptReply {}

message AcceptedRequest {
  int32 write_timestamp = 1;
  repeated Lease leases = 2;
}

message AcceptedReply {}
